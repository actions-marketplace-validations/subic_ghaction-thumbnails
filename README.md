# Thumbnail Generator GitHub Action

### Automatically generate image thumbnails when images are added to the repository.

## Usage

To add the thumbnail generator to your GitHub Actions pipeline, specify the name of this repository, optionally with a tag number (`@v1` is the current version) as a `step` within your `workflow.yml` file.

Inside your `.github/workflows/workflow.yml` file:

```yaml
steps:
- uses: actions/checkout@master
- uses: subic/ghaction-thumbnails@v1 # tag number optional, breaking changes not expected
  with: # Required arguments:
    source: 'images' # Input images folder, required both as an argument and as an existing directory path in repository which is also the reason for the previous checkout step (default: 'images').
    output: 'thumbnails' # Output thumbnails container folder, can be same as input or base directory, if the directory doesn't exist it will be created recursively (default: 'thumbnails').
    sizes: 480 # Output widths or dimensions separated with an 'x', can be a number or a comma-delimited string. Prefix height only sizes with 'x' when not setting widths; eg. "x360, x1080" (default: 480)).
```
>**Note**: The action is meant to be used in a (web assets) build chain so it only exposes the output directory and its contents to other GitHub actions. When using as a separate or individual build action, you will probably want to commit the generated image files. See the [full example workflow file](#example-workflowyml) below or the [example repostiory](https://github.com/subic/ghaction-thumbnails-example) for details.

### Inputs

The action supports 10 input arguments ([`source`](#source), [`output`](#output), [`sizes`](#sizes), [`subfolder`](#subfolder), [`filename`](#filename), [`extensions`](#extensions), [`fit`](#fit), [`position`](#position), [`enlarge`](#enlarge) and [`overwrite`](#overwrite)) but only the first three are required and validated. When others are omitted or wrong the action tries to defensively fall back onto sensible defaults which still generate useful images but it will error out on some illegal arguments. The images are processed using [sharp](https://github.com/lovell/sharp) so most of the optional arguments are just settings passed over to the actual image processing task.

| Input  | Description | Required | Default |
| :---: | :---: | :---: | :---: |
| [`source`](#source) | Source images folder | ‚úî | `'images'` |
| [`output`](#output) | Thumbnails output folder | ‚úî | `'thumbnails'` |
| [`sizes`](#sizes) | Thumbnail sizes | ‚úî | `480` |
| [`subfolder`](#subfolder) | Thumbnails subfolder pattern | êÑÇ | `'%D'` |
| [`filename`](#filename) | Thumbnail filename pattern | êÑÇ | `'%F'` |
| [`extensions`](#extensions) | Image extensions filter | êÑÇ | `'jpg, jpeg, png, webp, gif, tiff'` |
| [`fit`](#fit) | How the images should be resized to dimension | êÑÇ | `'cover'` |
| [`position`](#position) | Position, gravity or strategy for fit: cover or contain | êÑÇ | `'centre'` |
| [`enlarge`](#enlarge) | Enlarge smaller images to thumbnail dimensions | êÑÇ | `true` |
| [`overwrite`](#overwrite) | Overwrite existing images | êÑÇ | `false` |

#### `source`
Input images directory path (string) realtive to the repository base. **Required** both as an argument and as an existing directory path in repository. Action throws error if the argument path is not an existing repository folder. Default is `'images'`.

#### `output`
Output thumbnails directory path (string) realtive to the repository base. It is  **required** but the directory will be (recursively) created if not present. The argument will be output as a path string from the action to be used in further workflow jobs or steps. Default is `'thumbnails'`.

#### `sizes`
Output thumbnail dimensions (number, string or comma-delimited string of numbers or strings).

### Outputs

### Example usage


#### Example `workflow.yml`

```yaml
name: Generate thumbnails
on:
  push:
    branches:
      - master
    paths:
      - 'images/*'
jobs:
  generate_thumbnails:
    name: Generate thumbnails
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Process Images
        uses: subic/ghaction-thumbnails@v1
        with:
          source: 'images'
          output: 'thumbnails'
          sizes: 480
          subfolder: '%W'
      - name: Commit thumbnail folder
        run: |
          echo "Commiting folder ${{env.thumbnails}}"
          git config --local user.name "${{github.actor}}"
          git config --local user.email "${{github.actor}}@users.noreply.github.com"
          git add ./${{env.thumbnails}} || exit 0
          git commit -m "[skip ci] Autogenerated missing thumbnails" -a || exit 0
          git push -f -q https://${{secrets.GITHUB_TOKEN}}@github.com/${{github.repository}}
```

### Notes

## Development

### Repo structure

### Image script

### Scripts

### Contributions
Contributions are welcome! Check out the [Contribution Guide](CONTRIBUTING.md).

### Dependencies

### License

The code in this project is released under the [MIT License](LICENSE).
